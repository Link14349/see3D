{"version":3,"sources":["../src/Physics.js"],"names":["See3D","lib","Library","crash","item1","item2","type","position","x","y","z","i","planes","length","plane","Plane3D","p0","PointPositionWithPlane","j","points","point","Vector3","Item","method","item","items","sceneItems","scene","push","pushUpdate","self","crashItem","crashAny","v","norm","isNaN","define","trans","library","load","DEBUG","loadGlobal","global","toSee3D"],"mappings":"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","file":"Physics.js","sourcesContent":["'bpo enable';\n\n!function (See3D) {\n    let lib = new See3D.Library(\"Physics\");\n    \n    function crash(item1, item2) {\n        if (item1.type == \"Camera\") {\n            if (item2.type == \"Camera\") return (item1.position.x == item2.position.x && item1.position.y == item2.position.y && item1.position.z == item2.position.z);\n            return crash(item2, item1);// 因为如果item1和item2相撞了，那么item2就也和item1相撞了\n        }\n        if (item1.type == \"Point\") {\n            if (item2.type == \"Point\" || item2.type == \"Camera\") return (item1.position.x == item2.position.x && item1.position.y == item2.position.y && item1.position.z == item2.position.z);\n            return false;\n        }\n        for (let i = 0; i < item1.planes.length; i++) {\n            if (item2.type == \"Point\" || item2.type == \"Camera\") {\n                let plane = new See3D.Plane3D(item1.planes[i]);\n                plane.p0 = plane.p0 + item1.position;\n                if (See3D.PointPositionWithPlane(item2.position, plane) > 0) return false;\n            } else {\n                for (let j = 0; j < item2.points.length; j++) {\n                    let point = new See3D.Vector3(item2.points[j]);\n                    let plane = new See3D.Plane3D(item1.planes[i]);\n                    point = point + item2.position;\n                    plane.p0 = plane.p0 + item1.position;\n                    // console.log(point, plane);\n                    if (See3D.PointPositionWithPlane(point, plane) > 0) return false;\n                }\n            }\n        }\n        return true;\n    }\n\n    See3D.Item.method(\"crash\", function (item) {\n        return crash(this, item);\n    });\n    See3D.Item.method(\"crashAny\", function () {\n        let items = [];\n        let sceneItems = this.scene.items;\n        for (let i = 0; i < sceneItems.length; i++) {\n            if (crash(this, sceneItems[i])) items.push(sceneItems[i]);\n        }\n        return items;\n    });\n    See3D.Item.method(\"RigidBody\", function () {\n        this.pushUpdate(function (self) {\n            let crashItem = self.crashAny()[0];\n            if (!crashItem) return;\n            let v = (new Vector3(\n                self.position.x - crashItem.position.x,\n                self.position.y - crashItem.position.y,\n                self.position.z - crashItem.position.z,\n            )).norm();\n            if (isNaN(v.x) || isNaN(v.y) || isNaN(v.z)) {\n                v.x = 1;\n                v.y = 1;\n                v.z = 1;\n            }\n            // console.log(v);\n            // console.log(self.position.x, self.position.y, self.position.z);\n            // console.log(crashItem.position.x, crashItem.position.y, crashItem.position.z);\n            // console.log(\"=============\");\n            while (self.crash(crashItem)) {\n                self.position = self.position + v;\n                // console.log(self.position);\n            }\n            // console.log(self);\n        });\n    });\n\n    lib.define(\"crash\", crash);\n\n    lib.trans();\n    See3D.library(lib);\n    See3D.load(\"Physics\");\n    if (See3D.DEBUG) {\n        See3D.loadGlobal(\"Physics\");// 将库加入浏览器全局\n        lib.global();// 将库API加入浏览器全局\n    }\n    See3D.lib(\"Physics\");\n    lib.toSee3D();\n}(See3D);"]}