{"version":3,"sources":["../src/Physics.js"],"names":["See3D","lib","Library","crash","item1","item2","type","position","x","y","z","i","planes","length","plane","Plane3D","p0","PointPositionWithPlane","j","points","point","Vector3","Item","method","item","items","sceneItems","scene","push","name","noRigids","undefined","pushUpdate","self","crashItem","crashAny","String","v","norm","isNaN","console","log","define","trans","library","load","DEBUG","loadGlobal","global","toSee3D"],"mappings":"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","file":"Physics.js","sourcesContent":["'bpo enable';\n\n!function (See3D) {\n    let lib = new See3D.Library(\"Physics\");\n    \n    function crash(item1, item2) {\n        if (item1.type == \"Camera\") {\n            if (item2.type == \"Camera\") return (item1.position.x == item2.position.x && item1.position.y == item2.position.y && item1.position.z == item2.position.z);\n            return crash(item2, item1);// 因为如果item1和item2相撞了，那么item2就也和item1相撞了\n        }\n        if (item1.type == \"Point\") {\n            if (item2.type == \"Point\" || item2.type == \"Camera\") return (item1.position.x == item2.position.x && item1.position.y == item2.position.y && item1.position.z == item2.position.z);\n            return false;\n        }\n        // console.log(item2);\n        for (let i = 0; i < item1.planes.length; i++) {\n            if (item2.type == \"Point\" || item2.type == \"Camera\") {\n                let plane = new See3D.Plane3D(item1.planes[i]);\n                plane.p0 = plane.p0 + item1.position;\n                if (See3D.PointPositionWithPlane(item2.position, plane) > 0) {\n                    return false;\n                }\n            } else {\n                for (let j = 0; j < item2.points.length; j++) {\n                    let point = new See3D.Vector3(item2.points[j]);\n                    let plane = new See3D.Plane3D(item1.planes[i]);\n                    point = point + item2.position;\n                    plane.p0 = plane.p0 + item1.position;\n                    // console.log(point, plane);\n                    if (See3D.PointPositionWithPlane(point, plane) > 0) {\n                        return false;\n                    }\n                }\n            }\n        }\n        return true;\n    }\n\n    See3D.Item.method(\"crash\", function (item) {\n        return crash(this, item);\n    });\n    See3D.Item.method(\"crashAny\", function () {\n        let items = [];\n        let sceneItems = this.scene.items;\n        for (let i = 0; i < sceneItems.length; i++) {\n            if (crash(this, sceneItems[i]) && this !== sceneItems[i]) items.push(sceneItems[i]);\n        }\n        // console.log(sceneItems);\n        return items;\n    });\n    See3D.Item.method(\"noRigidBody\", function (name) {\n        if (this.noRigids === undefined) this.noRigids = {};\n        this.noRigids[name] = true;\n    });\n    See3D.Item.method(\"RigidBody\", function () {\n        if (this.noRigids === undefined) this.noRigids = {};\n        this.pushUpdate(function (self) {\n            // let index = 0;\n            let crashItem = self.crashAny()[0];\n            if (!crashItem) return;\n            let name = String(crashItem.name);\n            if (self.noRigids[name]) return;\n            // console.log(crashItem);\n            let v = (new Vector3(\n                self.position.x - crashItem.position.x,\n                self.position.y - crashItem.position.y,\n                self.position.z - crashItem.position.z,\n            )).norm();\n            if (isNaN(v.x) || isNaN(v.y) || isNaN(v.z)) {\n                v.x = 1;\n                v.y = 1;\n                v.z = 1;\n            }\n            // console.log(v);\n            // console.log(self.position.x, self.position.y, self.position.z);\n            // console.log(crashItem.position.x, crashItem.position.y, crashItem.position.z);\n            // console.log(\"=============\");\n            if (self.type == \"Cube\") console.log(self, crashItem, v);\n            while (self.crash(crashItem)) {\n                self.position = self.position + v;\n                // console.log(self.position);\n            }\n            // console.log(self);\n        });\n    });\n\n    lib.define(\"crash\", crash);\n\n    lib.trans();\n    See3D.library(lib);\n    See3D.load(\"Physics\");\n    if (See3D.DEBUG) {\n        See3D.loadGlobal(\"Physics\");// 将库加入浏览器全局\n        lib.global();// 将库API加入浏览器全局\n    }\n    See3D.lib(\"Physics\");\n    lib.toSee3D();\n}(See3D);"]}