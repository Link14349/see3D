{"version":3,"sources":["../src/item.js"],"names":["See3D","lib","Library","Item","p","Vector3","Zero","position","rotation","scene","updateFunList","slice","index","fun","push","i","length","del","d","tmp","Vector","res","Matrix","TransMove","get","r","TransRotate","pos","Vector4","x","y","z","left","forward","LibraryDefineObject","Scene","name","game","items","cameras","use","__name","item","type","c","splice","cn","render","noView","ctx","dom","Camera","__projType","PRESPECTIVE_PROJECTION","sw","width","sh","height","FOV_x","FOV_y","itemPoints","move","TransMoveInverse","rotate","trans","Math","max","tan","near_d","far_d","sort","a","b","ar","br","projType","update","array","j","points","planes","p0","Plane3D","screenPos","Vector2","ORTHOGONAL_PROJECTION","console","log","n","beginPath","arc","PI","fillStyle","color","fill","closePath","crop","pre","now","sx","sy","per","k","point","moveTo","lineTo","strokeStyle","stroke","test","l","sqrt","ITEM_CONFIG","entity","s","withItemConfig","load","config","error","Error","Array","arrN","arrP0","pop","t","Point","size","Cube","define","library","DEBUG","loadGlobal","global","toSee3D"],"mappings":"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","file":"item.js","sourcesContent":["'bpo enable';\n\n!function (See3D) {\n    let lib = new See3D.Library(\"View\");\n\n    class Item extends See3D.LibraryDefineObject {\n        constructor(p = See3D.Vector3.Zero()) {\n            super(\"Item\");\n            this.position = p;\n            this.rotation = See3D.Vector3.Zero();\n            this.scene = null;\n            this.updateFunList = Item.updateFunList.slice(0);\n            this.index = -1;\n            // console.log(r);\n            // this.rotate(r);\n        }\n        static pushUpdate(fun) {\n            this.updateFunList.push(fun);\n            return this;\n        }\n        pushUpdate(fun) {\n            this.updateFunList.push(fun);\n            return this;\n        }\n        update() {\n            for (let i = 0; i < this.updateFunList.length; i++) {\n                this.updateFunList[i](this);\n            }\n            return this;\n        }\n        del() {\n            if (this.scene && this.index > -1) {\n                this.scene.del(this.index);\n                this.index = -1;\n            }\n        }\n        move(d) {\n            let tmp = new Vector(this.position);\n            tmp.push(1);\n            let res = tmp * See3D.Matrix.TransMove(d);\n            this.position = new Vector3(res.get(0), res.get(1), res.get(2));\n            // console.log(this.position);\n            return this;\n        }\n        rotate(r) {\n            this.rotation = new Vector3(this.rotation.get(0) - r.get(0), this.rotation.get(1) - r.get(1), this.rotation.get(2) - r.get(2));\n            return this;\n        }\n        left(d) {\n            let r = this.rotation;\n            let rotation = See3D.Matrix.TransRotate(new Vector3(-r.get(0), -r.get(1), -r.get(2)));\n            let pos = new Vector4(d, 0, 0);\n            let p = pos * rotation;\n            this.position.x -= p.x;\n            this.position.y += p.y;\n            this.position.z += p.z;\n            return this;\n        }\n        right(d) {\n            return this.left(-d);\n        }\n        forward(d) {\n            let r = this.rotation;\n            let rotation = See3D.Matrix.TransRotate(new Vector3(-r.get(0), -r.get(1), -r.get(2)));\n            let pos = new Vector4(0, 0, d);\n            let p = pos * rotation;\n            this.position.x -= p.x;\n            this.position.y -= p.y;\n            this.position.z += p.z;\n            return this;\n        }\n        back(d) {\n            return this.forward(-d);\n        }\n    }\n    Item.updateFunList = [];\n\n    class Scene extends See3D.LibraryDefineObject {\n        constructor(name, game) {\n            super(\"Scene\");\n            this.game = game;\n            this.items = [];\n            this.cameras = {};\n            this.use = null;\n            this.__name = name;\n        }\n        get name() {\n            return this.__name;\n        }\n        push(item) {\n            item.scene = this;\n            if (item.type == \"Camera\") {\n                let c = item;\n                this.cameras[c.name] = c;\n                if (!this.use) this.use = c;\n            } else {\n                item.index = this.items.length;\n                this.items.push(item);\n            }\n            return this;\n        }\n        del(index) {\n            this.items.splice(index, 1);\n            return this;\n        }\n        get ctx() {\n            return this.game.ctx;\n        }\n        get dom() {\n            return this.game.dom;\n        }\n        camera(cn) {\n            this.use = this.cameras[cn];\n            return this;\n        }\n        render() {\n            if (this.use) {\n                this.use.render();\n            } else {\n                this.noView();\n            }\n            return this;\n        }\n        noView() {\n            this.game.noView();\n            return this;\n        }\n    }\n    class Camera extends Item {\n        constructor(p, name, scene) {\n            super(p);\n            this.type = \"Camera\";\n            this.scene = scene;\n            this.__name = name;\n            this.d = 0;\n            this.__projType = Camera.PRESPECTIVE_PROJECTION;\n        }\n        get projType() {\n            return this.__projType;\n        }\n        set projType(n) {\n            if (typeof n != \"number\") {\n                console.log(\"Error 201: Illegal camera projection type value: '\" + n + \"'\");\n                return null;\n            }\n            this.__projType = n;\n            return n;\n        }\n        render() {\n            // console.log(\"a\");\n            let items = this.scene.items;\n            let ctx = this.scene.ctx;\n            let {width: sw, height: sh} = this.scene.dom;\n            let {FOV_x, FOV_y} = See3D;\n            let itemPoints = [];\n            let move = See3D.Matrix.TransMoveInverse(this.position);\n            let rotate = See3D.Matrix.TransRotate(new See3D.Vector3(\n                -this.rotation.x, -this.rotation.y, -this.rotation.z\n            ));\n            let trans = move * rotate;\n            let d = Math.max(\n                sw / 100 / (2 * Math.tan(FOV_x / 2)),\n                sh / 100 / (2 * Math.tan(FOV_y / 2))\n            );\n            this.d = d;\n            let near_d = 0.1;\n            let far_d = 1000;\n            items.sort(function (x, y) {\n                let a = x.position, b = y.position;\n                let ar = a.x * a.x + a.y * a.y + a.z * a.z;\n                let br = b.x * b.x + b.y * b.y + b.z * b.z;\n                if (ar > br) return 1;\n                if (ar < br) return -1;\n                return 0;\n            });\n            let projType = this.projType;\n            // console.log(d);\n            // console.log(\"update\");\n            for (let i = 0; i < items.length; i++) {\n                items[i].update();\n                if (items[i].type == \"Point\") {\n                    let p = new See3D.Vector3(items[i].position);\n                    p.array.push(1);\n                    itemPoints.push(p * trans);\n                } else {\n                    itemPoints.push([[], [],\n                        (new See3D.Vector4(items[i].position.x, items[i].position.y, items[i].position.z, 1) * trans)\n                    ]);\n                    // console.log(items[i].points);\n                    for (let j = 0; j < items[i].points.length; j++) {\n                        let p = items[i].points[j] + items[i].position;\n                        p.array.push(1);\n                        itemPoints[itemPoints.length - 1][0].push(p * trans);\n                    }\n                    for (let j = 0; j < items[i].planes.length; j++) {\n                        let p = items[i].planes[j].p0 + items[i].position;\n                        p.array.push(1);\n                        p = p * trans;\n                        itemPoints[itemPoints.length - 1][1].push(new See3D.Plane3D(\n                            new Vector3(p.array), new Vector3(p.array)\n                        ));\n                    }\n                    // console.log(itemPoints[itemPoints.length - 1]);\n                }\n                // if (items[i].type == \"Cube\")\n                //     console.log(p * trans);\n            }\n            this.update();\n            // console.log(itemPoints);\n            for (let i = 0; i < itemPoints.length; i++) {\n                // console.log(itemPoints[i].get(2));\n                // console.log(itemPoints[i]);\n                let item = items[i];\n                if (item.type == \"Point\") {\n                    if (itemPoints[i].z < near_d || itemPoints[i].z > far_d) continue;// 超出远近裁面\n                    if (\n                        itemPoints[i].x > Math.tan(See3D.FOV_x / 2) * itemPoints[i].z\n                    ) continue;// 超出视景体右边缘\n                    if (\n                        itemPoints[i].x < -Math.tan(See3D.FOV_x / 2) * itemPoints[i].z\n                    ) continue;// 超出视景体左边缘\n                    if (\n                        itemPoints[i].y > Math.tan(See3D.FOV_y / 2) * itemPoints[i].z\n                    ) continue;// 超出视景体上边缘\n                    if (\n                        itemPoints[i].y < -Math.tan(See3D.FOV_y / 2) * itemPoints[i].z\n                    ) continue;// 超出视景体下边缘\n                    // console.log(\"a\");\n                    let screenPos;\n                    if (projType == Camera.PRESPECTIVE_PROJECTION) {\n                        screenPos = new See3D.Vector2(// 透视投影\n                            itemPoints[i].get(0) * d / itemPoints[i].get(2) * 100,\n                            -itemPoints[i].get(1) * d / itemPoints[i].get(2) * 100,// 因为在canvas上向下y坐标增加，和数学上相反，所以需要取反操作\n                        );\n                    } else if (projType == Camera.ORTHOGONAL_PROJECTION) {\n                        screenPos = new See3D.Vector2(\n                            itemPoints[i].get(0) * 100,\n                            -itemPoints[i].get(1) * 100,\n                        );\n                    } else {\n                        console.log(\"Error 201: Illegal camera projection type value: '\" + n + \"'\");\n                        return;\n                    }\n                    ctx.beginPath();\n                    ctx.arc(screenPos.x, screenPos.y, item.r, 0, Math.PI * 2);\n                    ctx.fillStyle = items[i].color;\n                    ctx.fill();\n                    ctx.closePath();\n                } else {\n                    let r = Camera.r(item);\n                    if (itemPoints[i][2].z - r > far_d) continue;// 超过远裁面\n                    if (itemPoints[i][2].z + r < near_d) continue;// 小于近裁面\n                    if (itemPoints[i][2].z < 0) continue;\n                    if (\n                        itemPoints[i][2].x - r > Math.tan(See3D.FOV_x / 2) * itemPoints[i][2].z\n                    ) continue;// 超出视景体右边缘\n                    if (\n                        itemPoints[i][2].x + r < -Math.tan(See3D.FOV_x / 2) * itemPoints[i][2].z\n                    ) continue;// 超出视景体左边缘\n                    if (\n                        itemPoints[i][2].y - r > Math.tan(See3D.FOV_y / 2) * itemPoints[i][2].z\n                    ) continue;// 超出视景体上边缘\n                    if (\n                        itemPoints[i][2].y + r < -Math.tan(See3D.FOV_y / 2) * itemPoints[i][2].z\n                    ) continue;// 超出视景体下边缘\n                    for (let j = 0; j < items[i].planes.length; j++) {\n                        // if (new See3D.Vector3(0, 1, 0) % items[i].planes[j].n > 0) continue;\n                        function crop(pre, now) {\n                        }\n                        ctx.beginPath();\n                        let sx, sy;\n                        let per = new Vector3(items[i].planes[j].points[items[i].planes[j].points.length - 1]);\n                        // console.log(\"========\");\n                        for (let k = 0; k < items[i].planes[j].points.length; k++) {\n                            let point = new Vector3(itemPoints[i][0][items[i].planes[j].points[k]]);\n                            if (point.z < near_d) {// 超出近裁面\n\n                            }\n                            if (point.z > far_d) {// 超出远裁面\n                            }\n                            if (\n                                point.x > Math.tan(See3D.FOV_x / 2) * point.z// 超出视景体右边缘\n                            ) {\n\n                            }\n                            if (\n                                point.x < -Math.tan(See3D.FOV_x / 2) * point.z// 超出视景体左边缘\n                            ) {\n\n                            }\n                            if (\n                                point.y > Math.tan(See3D.FOV_y / 2) * point.z// 超出视景体上边缘\n                            ) {\n\n                            }\n                            if (\n                                point.y < -Math.tan(See3D.FOV_y / 2) * point.z// 超出视景体下边缘\n                            ) {\n\n                            }\n                            let screenPos;\n                            if (projType == Camera.PRESPECTIVE_PROJECTION) {\n                                screenPos = new See3D.Vector2(// 透视投影\n                                    point.get(0) * d / point.get(2) * 100,\n                                    -point.get(1) * d / point.get(2) * 100,// 因为在canvas上向下y坐标增加，和数学上相反，所以需要取反操作\n                                );\n                            } else if (projType == Camera.ORTHOGONAL_PROJECTION) {\n                                screenPos = new See3D.Vector2(\n                                    point.get(0) * 100,\n                                    -point.get(1) * 100,\n                                );\n                                // console.log(screenPos);\n                            } else {\n                                console.log(\"Error 201: Illegal camera projection type value: '\" + n + \"'\");\n                                return;\n                            }\n                            if (k == 0) {\n                                ctx.moveTo(screenPos.x, screenPos.y);\n                                sx = screenPos.x;\n                                sy = screenPos.y;\n                            } else {\n                                ctx.lineTo(screenPos.x, screenPos.y);\n                            }\n                            per = new See3D.Vector3(point);\n                        }\n                        ctx.lineTo(sx, sy);\n                        ctx.strokeStyle = items[i].color;\n                        // ctx.fillStyle = items[i].color;\n                        ctx.stroke();\n                        // ctx.fill();\n                        ctx.closePath();\n                    }\n                }\n            }\n            return this;\n        }\n        revolution(r) {\n            let rotation = See3D.Matrix.TransRotate(new Vector3(r.get(0), r.get(1), r.get(2)));\n            let test = new Vector3(this.position);\n            test.push(1);\n            test = test * rotation;\n            this.position.x = test.x;\n            this.position.y = test.y;\n            this.position.z = test.z;\n            return this;\n        }\n        static r(item) {\n            let l = 0;\n            for (let i = 0; i < item.points.length; i++) {\n                let tmp = (item.points[i].x * item.points[i].x + item.points[i].y * item.points[i].y + item.points[i].z * item.points[i].z);\n                if (l < tmp) {\n                    l = tmp;\n                }\n            }\n            l = Math.sqrt(l);\n            return l;\n        }\n        get name() {\n            return this.__name;\n        }\n    }\n    Camera.PRESPECTIVE_PROJECTION = 0;\n    Camera.ORTHOGONAL_PROJECTION = 1;\n\n    let ITEM_CONFIG = {\n        \"Cube\": {\n            \"Points\": [\n                [1, 1, 1],\n                [1, 1, -1],\n                [1, -1, 1],\n                [1, -1, -1],\n                [-1, 1, 1],\n                [-1, 1, -1],\n                [-1, -1, 1],\n                [-1, -1, -1],\n            ],\n            \"Planes\": [\n                {\n                    \"n\": [1, 0, 0],\n                    \"p0\": [1, 0, 0],\n                    \"points\": [0, 2, 3, 1]\n                },\n                {\n                    \"n\": [-1, 0, 0],\n                    \"p0\": [-1, 0, 0],\n                    \"points\": [4, 6, 7, 5]\n                },\n                {\n                    \"n\": [0, 1, 0],\n                    \"p0\": [0, 1, 0],\n                    \"points\": [4, 6, 2, 0]\n                },\n                {\n                    \"n\": [0, -1, 0],\n                    \"p0\": [0, -1, 0],\n                    \"points\": [5, 1, 3, 7]\n                },\n                {\n                    \"n\": [0, 0, 1],\n                    \"p0\": [0, 0, 1],\n                    \"points\": [2, 0, 1, 3]\n                },\n                {\n                    \"n\": [0, 0, -1],\n                    \"p0\": [0, 0, -1],\n                    \"points\": [4, 6, 7, 5]\n                },\n            ]\n        }\n    };\n    // console.log(ITEM_CONFIG[\"Cube\"]);\n\n    class entity extends Item {\n        constructor(type, p, s, color, name, withItemConfig = true) {\n            super(p);\n            this.type = type;\n            this.planes = [];\n            this.points = [];\n            this.name = name;\n            this.s = s;\n            this.color = color;\n            if (withItemConfig) {\n                this.load();\n            }\n        }\n        load() {\n            let config = ITEM_CONFIG[this.type];\n            if (!config) {\n                console.error(new Error(\"Error 200: Configuration of the entity was not found.\\nEnity type: \" + this.type));\n                return this;\n            }\n            // console.log(ITEM_CONFIG, this.type);\n            for (let i = 0; i < config[\"Points\"].length; i++) {\n                let test = new See3D.Vector3(...Array(...config[\"Points\"][i]));\n                test.x *= this.s.x;\n                test.y *= this.s.y;\n                test.z *= this.s.z;\n                this.points.push(test);\n            }\n            // console.log(config);\n            for (let i = 0; i < config[\"Planes\"].length; i++) {\n                let arrN = Array(...config[\"Planes\"][i][\"n\"]);\n                let arrP0 = Array(...config[\"Planes\"][i][\"p0\"]);\n                // console.log(arrN);\n                arrN[0] *= this.s.x;\n                arrN[1] *= this.s.y;\n                arrN[2] *= this.s.z;\n                arrP0[0] *= this.s.x;\n                arrP0[1] *= this.s.y;\n                arrP0[2] *= this.s.z;\n                this.planes.push(new See3D.Plane3D(\n                    new Vector3(...arrN),\n                    new Vector3(...arrP0),\n                ));\n                this.planes[this.planes.length - 1].points = Array(...config[\"Planes\"][i][\"points\"]);\n            }\n            // console.log(this);\n            return this;\n        }\n        rotate(r) {\n            // console.log(r);\n            this.rotation = new Vector3(this.rotation.get(0) + r.get(0), this.rotation.get(1) + r.get(1), this.rotation.get(2) + r.get(2));\n            let rotation = See3D.Matrix.TransRotate(new Vector3(-r.get(0), -r.get(1), -r.get(2)));\n            // console.log(-r.get(0), -r.get(1), -r.get(2));\n            // console.log(rotation);\n            for (let i = 0; i < this.points.length; i++) {\n                this.points[i].push(1);\n                this.points[i] = this.points[i] * rotation;\n                this.points[i].array.pop();\n                this.points[i] = new Vector3(...this.points[i].array);\n            }\n            for (let i = 0; i < this.planes.length; i++) {\n                this.planes[i].p0.push(1);\n                this.planes[i].p0 = this.planes[i].p0 * rotation;\n                this.planes[i].p0.array.pop();\n                this.planes[i].p0 = new Vector3(...this.planes[i].p0.array);\n                this.planes[i].n = new Vector3(this.planes[i].p0);\n            }\n            return this;\n        }\n        translate(s) {\n            let t = new Vector3(-s.x, -s.y, -s.z);\n            for (let i = 0; i < this.points.length; i++) {\n                this.points[i] = this.points[i] + t;\n            }\n        }\n        scale(s) {\n            for (let i = 0; i < this.points.length; i++) {\n                this.points[i].x *= s.x;\n                this.points[i].y *= s.y;\n                this.points[i].z *= s.z;\n            }\n        }\n    }\n\n    class Point extends entity {\n        constructor(p = See3D.Vector3.Zero(), size = 10, color = \"#fff\", name = \"\") {\n            super(\"Point\", p, null, color, name, false);\n            this.r = size;\n        }\n    }\n    class Cube extends entity {\n        constructor(p = See3D.Vector3.Zero(), s = new See3D.Vector3(1, 1, 1), color = \"#fff\", name = \"\") {\n            s.x = (s.x == 0 ? s.x : s.x / 2);\n            s.y = (s.y == 0 ? s.y : s.y / 2);\n            s.z = (s.z == 0 ? s.z : s.z / 2);\n            super(\"Cube\", p, s, color, name);\n            // console.log(this);\n        }\n    }\n\n    lib.define(\"Item\", Item);// virtual\n\n    lib.define(\"Scene\", Scene);\n    lib.define(\"Camera\", Camera);// renderer\n\n    lib.define(\"entity\", entity);// virtual\n\n    lib.define(\"ITEM_CONFIG\", ITEM_CONFIG);\n    lib.define(\"Point\", Point);\n    lib.define(\"Cube\", Cube);\n\n    lib.trans();\n    See3D.library(lib);\n    See3D.load(\"View\");\n    if (See3D.DEBUG) {\n        See3D.loadGlobal(\"View\");// 将库加入浏览器全局\n        lib.global();// 将库API加入浏览器全局\n    }\n    See3D.lib(\"View\");\n    lib.toSee3D();\n}(See3D);"]}