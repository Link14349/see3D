{"version":3,"sources":["../src/item.js"],"names":["lib","See3D","Library","Item","p","Vector3","Zero","position","rotation","d","tmp","Vector","push","res","Matrix","TransMove","get","r","LibraryDefineObject","Scene","name","game","items","cameras","use","__name","item","type","c","cn","render","noView","ctx","dom","Camera","scene","sw","width","sh","height","FOV_x","FOV_y","itemPoints","move","TransMoveInverse","rotate","TransRotate","x","y","z","trans","Math","max","tan","near_d","far_d","i","length","array","j","points","planes","p0","Plane3D","n","screenPos","Vector2","beginPath","arc","PI","fillStyle","fill","closePath","k","moveTo","lineTo","strokeStyle","stroke","l","sqrt","ITEM_CONFIG","entity","s","withItemConfig","load","config","console","error","Error","arrN","arrP0","Point","size","Cube","define","library","DEBUG","loadGlobal","global","toSee3D"],"mappings":"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","file":"item.js","sourcesContent":["'bpo enable';\n\n!function () {\n    let lib = new See3D.Library(\"View\");\n\n    class Item extends See3D.LibraryDefineObject {\n        constructor(p = See3D.Vector3.Zero()) {\n            super(\"Item\");\n            this.position = p;\n            this.rotation = See3D.Vector3.Zero();\n            // console.log(r);\n            // this.rotate(r);\n        }\n        move(d) {\n            let tmp = new Vector(this.position);\n            tmp.push(1);\n            let res = tmp * See3D.Matrix.TransMove(d);\n            this.position = new Vector3(res.get(0), res.get(1), res.get(2));\n            // console.log(this.position);\n        }\n        rotate(r) {\n            this.rotation = new Vector3(this.rotation.get(0) + r.get(0), this.rotation.get(1) + r.get(1), this.rotation.get(2) + r.get(2));\n        }\n    }\n    class Scene extends See3D.LibraryDefineObject {\n        constructor(name, game) {\n            super(\"Scene\");\n            this.game = game;\n            this.items = [];\n            this.cameras = {};\n            this.use = null;\n            this.__name = name;\n        }\n        get name() {\n            return this.__name;\n        }\n        push(item) {\n            if (item.type == \"Camera\") {\n                let c = item;\n                this.cameras[c.name] = c;\n                if (!this.use) this.use = c;\n            } else {\n                this.items.push(item);\n            }\n            return this;\n        }\n        get ctx() {\n            return this.game.ctx;\n        }\n        get dom() {\n            return this.game.dom;\n        }\n        camera(cn) {\n            this.use = this.cameras[cn];\n            return this;\n        }\n        render() {\n            if (this.use) {\n                this.use.render();\n            } else {\n                this.noView();\n            }\n            return this;\n        }\n        noView() {\n            this.game.noView();\n            return this;\n        }\n    }\n    class Camera extends Item {\n        constructor(p, name, scene) {\n            super(p);\n            this.type = \"Camera\";\n            this.scene = scene;\n            this.__name = name;\n        }\n        render() {\n            // console.log(\"a\");\n            let items = this.scene.items;\n            let ctx = this.scene.ctx;\n            let {width: sw, height: sh} = this.scene.dom;\n            let {FOV_x, FOV_y} = See3D;\n            let itemPoints = [];\n            let move = See3D.Matrix.TransMoveInverse(this.position);\n            let rotate = See3D.Matrix.TransRotate(new See3D.Vector3(\n                -this.rotation.x, -this.rotation.y, -this.rotation.z\n            ));\n            let trans = move * rotate;\n            let d = Math.max(\n                sw / 100 / (2 * Math.tan(FOV_x / 2)),\n                sh / 100 / (2 * Math.tan(FOV_y / 2))\n            );\n            let near_d = d + 0.1;\n            let far_d = 1000;\n            // console.log(d);\n            // console.log(\"update\");\n            for (let i = 0; i < items.length; i++) {\n                if (items[i].type == \"Point\") {\n                    let p = new See3D.Vector3(items[i].position);\n                    p.array.push(1);\n                    itemPoints.push(p * trans);\n                } else {\n                    itemPoints.push([[], []]);\n                    // console.log(items[i].points);\n                    for (let j = 0; j < items[i].points.length; j++) {\n                        let p = items[i].points[j] + items[i].position;\n                        p.array.push(1);\n                        itemPoints[itemPoints.length - 1][0].push(p * trans);\n                    }\n                    for (let j = 0; j < items[i].planes.length; j++) {\n                        let p = items[i].planes[j].p0 + items[i].position;\n                        p.array.push(1);\n                        itemPoints[itemPoints.length - 1][1].push(new See3D.Plane3D(\n                            items[i].planes[j].n, p * trans\n                        ));\n                    }\n                    // console.log(itemPoints[itemPoints.length - 1]);\n                }\n                // if (items[i].type == \"Cube\")\n                //     console.log(p * trans);\n            }\n            // console.log(itemPoints);\n            for (let i = 0; i < itemPoints.length; i++) {\n                // console.log(itemPoints[i].get(2));\n                // console.log(itemPoints[i]);\n                let item = items[i];\n                if (item.type == \"Point\") {\n                    if (itemPoints[i].get(2) < near_d || itemPoints[i].get(2) > far_d) continue;// 超出远近裁面\n                    // console.log(\"a\");\n                    let screenPos = new See3D.Vector2(\n                        itemPoints[i].get(0) * d / itemPoints[i].get(2) * 100,\n                        -itemPoints[i].get(1) * d / itemPoints[i].get(2) * 100,// 因为在canvas上向下y坐标增加，和数学上相反，所以需要取反操作\n                    );\n                    ctx.beginPath();\n                    ctx.arc(screenPos.x, screenPos.y, item.r, 0, Math.PI * 2);\n                    ctx.fillStyle = \"#fff\";\n                    ctx.fill();\n                    ctx.closePath();\n                } else {\n                    let r = Camera.r(item);\n                    if (item.position.z - r > far_d) continue;// 超过远裁面\n                    if (item.position.z + r < near_d) continue;// 小于近裁面\n                    if (\n                        item.position.x - r > Math.tan(See3D.FOV_x / 2) * item.position.z\n                    ) continue;// 超出视景体右边缘\n                    if (\n                        item.position.x + r < -Math.tan(See3D.FOV_x / 2) * item.position.z\n                    ) continue;// 超出视景体左边缘\n                    if (\n                        item.position.y - r > Math.tan(See3D.FOV_y / 2) * item.position.z\n                    ) continue;// 超出视景体上边缘\n                    if (\n                        item.position.y + r < -Math.tan(See3D.FOV_y / 2) * item.position.z\n                    ) continue;// 超出视景体下边缘\n                    // console.log(r);\n                    // console.log(\"a\");\n                    // console.log(item, itemPoints[i]);\n                    ctx.beginPath();\n                    // for (let j = 0; j < itemPoints[i][1].length; j++) {}\n                    for (let k = 0; k < itemPoints[i][0].length; k++) {\n                        // console.log(itemPoints[i][0][k]);\n                        let screenPos = new See3D.Vector2(\n                            itemPoints[i][0][k].get(0) * d / itemPoints[i][0][k].get(2) * 100,\n                            -itemPoints[i][0][k].get(1) * d / itemPoints[i][0][k].get(2) * 100,// 因为在canvas上向下y坐标增加，和数学上相反，所以需要取反操作\n                        );\n                        // if (item.type == \"Cube\") console.log(screenPos.x, screenPos.y);\n                        // ctx.arc(screenPos.x, screenPos.y, 5, 0, Math.PI * 2);\n                        if (k == 0) ctx.moveTo(screenPos.x, screenPos.y);\n                        else ctx.lineTo(screenPos.x, screenPos.y);\n                        // ctx.fillStyle = \"#fff\";\n                        // ctx.fill();\n                    }\n                    ctx.strokeStyle = \"#fff\";\n                    ctx.stroke();\n                    ctx.closePath();\n                    // console.log(\"==============\");\n                    // for (let i = 0; i < item.points.length; i++) {\n                    //     let x = item.points[i].x + item.position.x;\n                    //     let y = item.points[i].y + item.position.y;\n                    //     let z = item.points[i].z + item.position.z;\n                    //     let screenPos = new See3D.Vector2(\n                    //         x * d / z * 100,\n                    //         -y * d / z * 100,// 因为在canvas上向下y坐标增加，和数学上相反，所以需要取反操作\n                    //     );\n                    //     // if (item.type == \"Cube\") console.log(screenPos.x, screenPos.y);\n                    //     ctx.beginPath();\n                    //     ctx.arc(screenPos.x, screenPos.y, 2, 0, Math.PI * 2);\n                    //     ctx.fillStyle = \"#fff\";\n                    //     ctx.fill();\n                    //     ctx.closePath();\n                    // }\n                    // ctx.beginPath();\n                    // ctx.arc(0, 0, 10, 0, Math.PI * 2);\n                    // ctx.fillStyle = \"#fff\";\n                    // ctx.fill();\n                    // ctx.closePath();\n                }\n                // console.log(screenPos);\n            }\n            return this;\n        }\n        static r(item) {\n            let l = 0;\n            for (let i = 0; i < item.points.length; i++) {\n                let tmp = (item.points[i].x * item.points[i].x + item.points[i].y * item.points[i].y + item.points[i].z * item.points[i].z);\n                if (l < tmp) {\n                    l = tmp;\n                }\n            }\n            l = Math.sqrt(l);\n            return l;\n        }\n        get name() {\n            return this.__name;\n        }\n    }\n\n    let ITEM_CONFIG = {\n        \"Cube\": {\n            \"Points\": [\n                [1, 1, 1],\n                [1, 1, -1],\n                [1, -1, 1],\n                [1, -1, -1],\n                [-1, 1, 1],\n                [-1, 1, -1],\n                [-1, -1, 1],\n                [-1, -1, -1],\n            ],\n            \"Planes\": [\n                {\n                    \"n\": [1, 0, 0],\n                    \"p0\": [1, 0, 0]\n                },\n                {\n                    \"n\": [-1, 0, 0],\n                    \"p0\": [-1, 0, 0]\n                },\n                {\n                    \"n\": [0, 1, 0],\n                    \"p0\": [0, 1, 0]\n                },\n                {\n                    \"n\": [0, -1, 0],\n                    \"p0\": [0, -1, 0]\n                },\n                {\n                    \"n\": [0, 0, 1],\n                    \"p0\": [0, 0, 1]\n                },\n                {\n                    \"n\": [0, 0, -1],\n                    \"p0\": [0, 0, -1]\n                },\n            ]\n        }\n    };\n\n    class entity extends Item {\n        constructor(type, p, s, withItemConfig = true) {\n            super(p);\n            this.type = type;\n            this.planes = [];\n            this.points = [];\n            this.s = s;\n            if (withItemConfig) {\n                this.load();\n            }\n        }\n        load() {\n            let config = ITEM_CONFIG[this.type];\n            if (!config) {\n                console.error(new Error(\"Error 200: Configuration of the entity was not found.\\nEnity type: \" + this.type));\n                return this;\n            }\n            // console.log(ITEM_CONFIG, this.type);\n            for (let i = 0; i < config[\"Points\"].length; i++) {\n                this.points.push(new See3D.Vector3(...config[\"Points\"][i]));\n            }\n            for (let i = 0; i < config[\"Planes\"].length; i++) {\n                let arrN = config[\"Planes\"][i][\"n\"];\n                let arrP0 = config[\"Planes\"][i][\"p0\"];\n                arrN[0] *= this.s.get(0);\n                arrN[1] *= this.s.get(1);\n                arrN[2] *= this.s.get(2);\n                arrP0[0] *= this.s.get(0);\n                arrP0[1] *= this.s.get(1);\n                arrP0[2] *= this.s.get(2);\n                this.planes.push(new See3D.Plane3D(\n                    new Vector3(...arrN),\n                    new Vector3(...arrP0),\n                ));\n            }\n            return this;\n        }\n        rotate(r) {\n            // console.log(r);\n            this.rotation = new Vector3(this.rotation.get(0) + r.get(0), this.rotation.get(1) + r.get(1), this.rotation.get(2) + r.get(2));\n            let rotation = See3D.Matrix.TransRotate(-r.get(0), -r.get(1), -r.get(2));\n            for (let i = 0; i < this.points.length; i++) {\n                this.points[i] = this.points[i] * rotation;\n            }\n            for (let i = 0; i < this.planes.length; i++) {\n                this.planes[i].n = this.planes[i].n * rotation;\n                this.planes[i].p0 = this.planes[i].p0 * rotation;\n            }\n        }\n    }\n\n    class Point extends entity {\n        constructor(p = See3D.Vector3.Zero(), size = 10) {\n            super(\"Point\", p, null, false);\n            this.r = size;\n        }\n    }\n    class Cube extends entity {\n        constructor(p = See3D.Vector3.Zero(), s = new See3D.Vector3(1, 1, 1)) {\n            super(\"Cube\", p, s);\n        }\n    }\n\n    lib.define(\"Item\", Item);// virtual\n\n    lib.define(\"Scene\", Scene);\n    lib.define(\"Camera\", Camera);// renderer\n\n    lib.define(\"entity\", entity);// virtual\n\n    lib.define(\"ITEM_CONFIG\", ITEM_CONFIG);\n    lib.define(\"Point\", Point);\n    lib.define(\"Cube\", Cube);\n\n    lib.trans();\n    See3D.library(lib);\n    See3D.load(\"View\");\n    if (See3D.DEBUG) {\n        See3D.loadGlobal(\"Math3D\");// 将库加入浏览器全局\n        lib.global();// 将库API加入浏览器全局\n    }\n    See3D.lib(\"View\");\n    lib.toSee3D();\n}();"]}