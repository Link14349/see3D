{"version":3,"sources":["../src/item.js"],"names":["See3D","lib","Library","Item","p","Vector3","Zero","position","rotation","scene","updateFunList","slice","fun","push","i","length","d","tmp","Vector","res","Matrix","TransMove","get","r","TransRotate","pos","Vector4","x","y","z","left","forward","LibraryDefineObject","Scene","name","game","items","cameras","use","__name","item","type","c","cn","render","noView","ctx","dom","Camera","sw","width","sh","height","FOV_x","FOV_y","itemPoints","move","TransMoveInverse","rotate","trans","Math","max","tan","near_d","far_d","sort","a","b","ar","br","update","array","j","points","planes","p0","Plane3D","n","screenPos","Vector2","beginPath","arc","PI","fillStyle","color","fill","closePath","sx","sy","k","point","moveTo","lineTo","strokeStyle","stroke","test","l","sqrt","ITEM_CONFIG","entity","s","withItemConfig","load","config","console","error","Error","arrN","arrP0","pop","Point","size","Cube","define","library","DEBUG","loadGlobal","global","toSee3D"],"mappings":"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","file":"item.js","sourcesContent":["'bpo enable';\n\n!function (See3D) {\n    let lib = new See3D.Library(\"View\");\n\n    class Item extends See3D.LibraryDefineObject {\n        constructor(p = See3D.Vector3.Zero()) {\n            super(\"Item\");\n            this.position = p;\n            this.rotation = See3D.Vector3.Zero();\n            this.scene = null;\n            this.updateFunList = Item.updateFunList.slice(0);\n            // console.log(r);\n            // this.rotate(r);\n        }\n        static pushUpdate(fun) {\n            this.updateFunList.push(fun);\n            return this;\n        }\n        pushUpdate(fun) {\n            this.updateFunList.push(fun);\n            return this;\n        }\n        update() {\n            for (let i = 0; i < this.updateFunList.length; i++) {\n                this.updateFunList[i](this);\n            }\n            return this;\n        }\n        move(d) {\n            let tmp = new Vector(this.position);\n            tmp.push(1);\n            let res = tmp * See3D.Matrix.TransMove(d);\n            this.position = new Vector3(res.get(0), res.get(1), res.get(2));\n            // console.log(this.position);\n            return this;\n        }\n        rotate(r) {\n            this.rotation = new Vector3(this.rotation.get(0) + r.get(0), this.rotation.get(1) + r.get(1), this.rotation.get(2) + r.get(2));\n            return this;\n        }\n        left(d) {\n            let r = this.rotation;\n            let rotation = See3D.Matrix.TransRotate(new Vector3(-r.get(0), -r.get(1), -r.get(2)));\n            let pos = new Vector4(d, 0, 0);\n            let p = pos * rotation;\n            this.position.x -= p.x;\n            this.position.y += p.y;\n            this.position.z += p.z;\n            return this;\n        }\n        right(d) {\n            return this.left(-d);\n        }\n        forward(d) {\n            let r = this.rotation;\n            let rotation = See3D.Matrix.TransRotate(new Vector3(-r.get(0), -r.get(1), -r.get(2)));\n            let pos = new Vector4(0, 0, d);\n            let p = pos * rotation;\n            this.position.x -= p.x;\n            this.position.y -= p.y;\n            this.position.z += p.z;\n            return this;\n        }\n        back(d) {\n            return this.forward(-d);\n        }\n    }\n    Item.updateFunList = [];\n\n    class Scene extends See3D.LibraryDefineObject {\n        constructor(name, game) {\n            super(\"Scene\");\n            this.game = game;\n            this.items = [];\n            this.cameras = {};\n            this.use = null;\n            this.__name = name;\n        }\n        get name() {\n            return this.__name;\n        }\n        push(item) {\n            item.scene = this;\n            if (item.type == \"Camera\") {\n                let c = item;\n                this.cameras[c.name] = c;\n                if (!this.use) this.use = c;\n            } else {\n                this.items.push(item);\n            }\n            return this;\n        }\n        get ctx() {\n            return this.game.ctx;\n        }\n        get dom() {\n            return this.game.dom;\n        }\n        camera(cn) {\n            this.use = this.cameras[cn];\n            return this;\n        }\n        render() {\n            if (this.use) {\n                this.use.render();\n            } else {\n                this.noView();\n            }\n            return this;\n        }\n        noView() {\n            this.game.noView();\n            return this;\n        }\n    }\n    class Camera extends Item {\n        constructor(p, name, scene) {\n            super(p);\n            this.type = \"Camera\";\n            this.scene = scene;\n            this.__name = name;\n            this.d = 0;\n        }\n        render() {\n            // console.log(\"a\");\n            let items = this.scene.items;\n            let ctx = this.scene.ctx;\n            let {width: sw, height: sh} = this.scene.dom;\n            let {FOV_x, FOV_y} = See3D;\n            let itemPoints = [];\n            let move = See3D.Matrix.TransMoveInverse(this.position);\n            let rotate = See3D.Matrix.TransRotate(new See3D.Vector3(\n                -this.rotation.x, -this.rotation.y, -this.rotation.z\n            ));\n            let trans = move * rotate;\n            let d = Math.max(\n                sw / 100 / (2 * Math.tan(FOV_x / 2)),\n                sh / 100 / (2 * Math.tan(FOV_y / 2))\n            );\n            this.d = d;\n            let near_d = 0.1;\n            let far_d = 1000;\n            items.sort(function (x, y) {\n                let a = x.position, b = y.position;\n                let ar = a.x * a.x + a.y * a.y + a.z * a.z;\n                let br = b.x * b.x + b.y * b.y + b.z * b.z;\n                if (ar > br) return 1;\n                if (ar < br) return -1;\n                return 0;\n            });\n            // console.log(d);\n            // console.log(\"update\");\n            for (let i = 0; i < items.length; i++) {\n                items[i].update();\n                if (items[i].type == \"Point\") {\n                    let p = new See3D.Vector3(items[i].position);\n                    p.array.push(1);\n                    itemPoints.push(p * trans);\n                } else {\n                    itemPoints.push([[], [],\n                        (new See3D.Vector4(items[i].position.x, items[i].position.y, items[i].position.z, 1) * trans)\n                    ]);\n                    // console.log(items[i].points);\n                    for (let j = 0; j < items[i].points.length; j++) {\n                        let p = items[i].points[j] + items[i].position;\n                        p.array.push(1);\n                        itemPoints[itemPoints.length - 1][0].push(p * trans);\n                    }\n                    for (let j = 0; j < items[i].planes.length; j++) {\n                        let p = items[i].planes[j].p0 + items[i].position;\n                        p.array.push(1);\n                        itemPoints[itemPoints.length - 1][1].push(new See3D.Plane3D(\n                            items[i].planes[j].n, p * trans\n                        ));\n                    }\n                    // console.log(itemPoints[itemPoints.length - 1]);\n                }\n                // if (items[i].type == \"Cube\")\n                //     console.log(p * trans);\n            }\n            this.update();\n            // console.log(itemPoints);\n            for (let i = 0; i < itemPoints.length; i++) {\n                // console.log(itemPoints[i].get(2));\n                // console.log(itemPoints[i]);\n                let item = items[i];\n                if (item.type == \"Point\") {\n                    if (itemPoints[i].z < near_d || itemPoints[i].z > far_d) continue;// 超出远近裁面\n                    if (\n                        itemPoints[i].x > Math.tan(See3D.FOV_x / 2) * itemPoints[i].z\n                    ) continue;// 超出视景体右边缘\n                    if (\n                        itemPoints[i].x < -Math.tan(See3D.FOV_x / 2) * itemPoints[i].z\n                    ) continue;// 超出视景体左边缘\n                    if (\n                        itemPoints[i].y > Math.tan(See3D.FOV_y / 2) * itemPoints[i].z\n                    ) continue;// 超出视景体上边缘\n                    if (\n                        itemPoints[i].y < -Math.tan(See3D.FOV_y / 2) * itemPoints[i].z\n                    ) continue;// 超出视景体下边缘\n                    // console.log(\"a\");\n                    let screenPos = new See3D.Vector2(\n                        itemPoints[i].get(0) * d / itemPoints[i].get(2) * 100,\n                        -itemPoints[i].get(1) * d / itemPoints[i].get(2) * 100,// 因为在canvas上向下y坐标增加，和数学上相反，所以需要取反操作\n                    );\n                    ctx.beginPath();\n                    ctx.arc(screenPos.x, screenPos.y, item.r, 0, Math.PI * 2);\n                    ctx.fillStyle = items[i].color;\n                    ctx.fill();\n                    ctx.closePath();\n                } else {\n                    let r = Camera.r(item);\n                    if (itemPoints[i][2].z - r > far_d) continue;// 超过远裁面\n                    if (itemPoints[i][2].z + r < near_d) continue;// 小于近裁面\n                    if (itemPoints[i][2].z < 0) continue;\n                    if (\n                        itemPoints[i][2].x - r > Math.tan(See3D.FOV_x / 2) * itemPoints[i][2].z\n                    ) continue;// 超出视景体右边缘\n                    if (\n                        itemPoints[i][2].x + r < -Math.tan(See3D.FOV_x / 2) * itemPoints[i][2].z\n                    ) continue;// 超出视景体左边缘\n                    if (\n                        itemPoints[i][2].y - r > Math.tan(See3D.FOV_y / 2) * itemPoints[i][2].z\n                    ) continue;// 超出视景体上边缘\n                    if (\n                        itemPoints[i][2].y + r < -Math.tan(See3D.FOV_y / 2) * itemPoints[i][2].z\n                    ) continue;// 超出视景体下边缘\n                    for (let j = 0; j < items[i].planes.length; j++) {\n                        // if (new See3D.Vector3(0, 1, 0) % items[i].planes[j].n <= 0) continue;\n                        ctx.beginPath();\n                        let sx, sy;\n                        for (let k = 0; k < items[i].planes[j].points.length; k++) {\n                            let point = itemPoints[i][0][items[i].planes[j].points[k]];\n                            let screenPos = new See3D.Vector2(\n                                point.x * d / point.z * 100,\n                                -point.y * d / point.z * 100,// 因为在canvas上向下y坐标增加，和数学上相反，所以需要取反操作\n                            );\n                            if (k == 0) {\n                                ctx.moveTo(screenPos.x, screenPos.y);\n                                sx = screenPos.x;\n                                sy = screenPos.y;\n                            } else {\n                                ctx.lineTo(screenPos.x, screenPos.y);\n                            }\n                        }\n                        ctx.lineTo(sx, sy);\n                        ctx.strokeStyle = items[i].color;\n                        // ctx.fillStyle = items[i].color;\n                        ctx.stroke();\n                        // ctx.fill();\n                        ctx.closePath();\n                    }\n                }\n            }\n            return this;\n        }\n        revolution(r) {\n            let rotation = See3D.Matrix.TransRotate(new Vector3(r.get(0), r.get(1), r.get(2)));\n            let test = new Vector3(this.position);\n            test.push(1);\n            test = test * rotation;\n            this.position.x = test.x;\n            this.position.y = test.y;\n            this.position.z = test.z;\n            return this;\n        }\n        static r(item) {\n            let l = 0;\n            for (let i = 0; i < item.points.length; i++) {\n                let tmp = (item.points[i].x * item.points[i].x + item.points[i].y * item.points[i].y + item.points[i].z * item.points[i].z);\n                if (l < tmp) {\n                    l = tmp;\n                }\n            }\n            l = Math.sqrt(l);\n            return l;\n        }\n        get name() {\n            return this.__name;\n        }\n    }\n\n    let ITEM_CONFIG = {\n        \"Cube\": {\n            \"Points\": [\n                [1, 1, 1],\n                [1, 1, -1],\n                [1, -1, 1],\n                [1, -1, -1],\n                [-1, 1, 1],\n                [-1, 1, -1],\n                [-1, -1, 1],\n                [-1, -1, -1],\n            ],\n            \"Planes\": [\n                {\n                    \"n\": [1, 0, 0],\n                    \"p0\": [0.5, 0, 0],\n                    \"points\": [0, 2, 3, 1]\n                },\n                {\n                    \"n\": [-1, 0, 0],\n                    \"p0\": [-0.5, 0, 0],\n                    \"points\": [4, 6, 7, 5]\n                },\n                {\n                    \"n\": [0, 1, 0],\n                    \"p0\": [0, 0.5, 0],\n                    \"points\": [4, 6, 2, 0]\n                },\n                {\n                    \"n\": [0, -1, 0],\n                    \"p0\": [0, -0.5, 0],\n                    \"points\": [5, 1, 3, 7]\n                },\n                {\n                    \"n\": [0, 0, 1],\n                    \"p0\": [0, 0, 0.5],\n                    \"points\": [2, 0, 1, 3]\n                },\n                {\n                    \"n\": [0, 0, -1],\n                    \"p0\": [0, 0, -0.5],\n                    \"points\": [4, 6, 7, 5]\n                },\n            ]\n        }\n    };\n\n    class entity extends Item {\n        constructor(type, p, s, color, withItemConfig = true) {\n            super(p);\n            this.type = type;\n            this.planes = [];\n            this.points = [];\n            this.s = s;\n            this.color = color;\n            if (withItemConfig) {\n                this.load();\n            }\n        }\n        load() {\n            let config = ITEM_CONFIG[this.type];\n            if (!config) {\n                console.error(new Error(\"Error 200: Configuration of the entity was not found.\\nEnity type: \" + this.type));\n                return this;\n            }\n            // console.log(ITEM_CONFIG, this.type);\n            for (let i = 0; i < config[\"Points\"].length; i++) {\n                let test = new See3D.Vector3(...config[\"Points\"][i]);\n                test.x *= this.s.x;\n                test.y *= this.s.y;\n                test.z *= this.s.z;\n                this.points.push(test);\n            }\n            for (let i = 0; i < config[\"Planes\"].length; i++) {\n                let arrN = config[\"Planes\"][i][\"n\"];\n                let arrP0 = config[\"Planes\"][i][\"p0\"];\n                arrN[0] *= this.s.x;\n                arrN[1] *= this.s.y;\n                arrN[2] *= this.s.z;\n                arrP0[0] *= this.s.x;\n                arrP0[1] *= this.s.y;\n                arrP0[2] *= this.s.z;\n                this.planes.push(new See3D.Plane3D(\n                    new Vector3(...arrN),\n                    new Vector3(...arrP0),\n                ));\n                this.planes[this.planes.length - 1].points = config[\"Planes\"][i][\"points\"];\n            }\n            return this;\n        }\n        rotate(r) {\n            // console.log(r);\n            this.rotation = new Vector3(this.rotation.get(0) + r.get(0), this.rotation.get(1) + r.get(1), this.rotation.get(2) + r.get(2));\n            let rotation = See3D.Matrix.TransRotate(new Vector3(-r.get(0), -r.get(1), -r.get(2)));\n            // console.log(-r.get(0), -r.get(1), -r.get(2));\n            // console.log(rotation);\n            for (let i = 0; i < this.points.length; i++) {\n                this.points[i].push(1);\n                this.points[i] = this.points[i] * rotation;\n                this.points[i].array.pop();\n                this.points[i] = new Vector3(...this.points[i].array);\n            }\n            for (let i = 0; i < this.planes.length; i++) {\n                this.planes[i].n.push(1);\n                this.planes[i].n = this.planes[i].n * rotation;\n                this.planes[i].n.array.pop();\n                this.planes[i].n = new Vector3(...this.planes[i].n.array);\n                this.planes[i].p0 = new Vector3(this.planes[i].n);\n            }\n            return this;\n        }\n    }\n\n    class Point extends entity {\n        constructor(p = See3D.Vector3.Zero(), size = 10, color = \"#fff\") {\n            super(\"Point\", p, null, color, false);\n            this.r = size;\n        }\n    }\n    class Cube extends entity {\n        constructor(p = See3D.Vector3.Zero(), s = new See3D.Vector3(1, 1, 1), color = \"#fff\") {\n            s.x = (s.x == 0 ? s.x : s.x / 2);\n            s.y = (s.y == 0 ? s.y : s.y / 2);\n            s.z = (s.z == 0 ? s.z : s.z / 2);\n            super(\"Cube\", p, s, color);\n        }\n    }\n\n    lib.define(\"Item\", Item);// virtual\n\n    lib.define(\"Scene\", Scene);\n    lib.define(\"Camera\", Camera);// renderer\n\n    lib.define(\"entity\", entity);// virtual\n\n    lib.define(\"ITEM_CONFIG\", ITEM_CONFIG);\n    lib.define(\"Point\", Point);\n    lib.define(\"Cube\", Cube);\n\n    lib.trans();\n    See3D.library(lib);\n    See3D.load(\"View\");\n    if (See3D.DEBUG) {\n        See3D.loadGlobal(\"View\");// 将库加入浏览器全局\n        lib.global();// 将库API加入浏览器全局\n    }\n    See3D.lib(\"View\");\n    lib.toSee3D();\n}(See3D);"]}