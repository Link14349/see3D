{"version":3,"sources":["../src/index.js"],"names":["See3D","dom","document","createElement","__dom","__ctx","getContext","loadGlobal","bindLibrary","sout","IO","sostream","__scenes","use","__fps","__BGC","defaultBGC","i","w","width","height","window","innerWidth","innerHeight","s","name","n","ctx","beginPath","fillStyle","fillRect","closePath","save","translate","render","restore","noView","PhyFun","ViewFun","self","time","count","setInterval","requestAnimationFrame","cb","clearRect","textAlign","font","fillText","__loads","load","lib","defines","__libraries","get","entry","console","log","set","push","globalThis","version","DEBUG","Map","Library","val","private","error","Error","LibraryDefineObject","type","checkType","obj","transType","FOV_x","Math","PI","FOV_y"],"mappings":"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","file":"index.js","sourcesContent":["/*!\n\n * See3D 3D Rendering Engine Library\n\n * yhzheng - v0.0.1 (Wed Feb 27 2019 22:22:36 GMT+0800)\n\n * https://github.com/qianduanXIAOHAOZI/see3D/tree/master | Released under MIT license\n\n */\n/**\n * @file index.js\n * @overview 提供整体接口\n */\n\n// const DEBUG = true;\n\n/**\n * @class See3D\n * @constructor\n * @desc See3D类是可以将一个canvas变为See3D画布的类，一切操作都依靠它 \\n\n * 也是所有See3D API的容器，相当于一个module\n */\nclass See3D {\n    constructor(dom = document.createElement(\"canvas\")) {\n        this.__dom = dom;\n        this.__ctx = dom.getContext(\"2d\");\n        this.loadGlobal();\n        this.bindLibrary(\"IO\");\n        this.bindLibrary(\"Math3D\");\n        this.sout = new See3D.IO.sostream(this);\n        this.__scenes = {};\n        this.use = null;\n        this.__fps = 0;\n        // this.__time = 0;\n        this.__BGC = See3D.defaultBGC;\n        for (let i in dom) {\n            if (!this[i]) this[i] = dom[i];\n        }\n    }\n    width(w) {\n        if (w === void(0)) {\n            return this.__dom.width;\n        }\n        this.__dom.width = w;\n        return this;\n    }\n    height(w) {\n        if (w === void(0)) {\n            return this.__dom.height;\n        }\n        this.__dom.height = w;\n        return this;\n    }\n    full() {\n        this\n            .width(window.innerWidth)\n            .height(window.innerHeight)\n        ;\n        return this;\n    }\n    resize() {\n        this\n            .width(window.innerWidth)\n            .height(window.innerHeight)\n        ;\n    }\n    push(s) {\n        this.__scenes[s.name] = s;\n        if (!this.use) this.use = s;\n        return this;\n    }\n    scene(n) {\n        this.use = this.__scenes[n];\n        return this;\n    }\n    render() {\n        this.ctx.beginPath();\n        this.ctx.fillStyle = this.__BGC;\n        this.ctx.fillRect(0, 0, this.dom.width, this.dom.height);\n        this.ctx.closePath();\n        this.ctx.save();\n        this.ctx.translate(this.dom.width / 2, this.dom.height / 2);\n        if (this.use) {\n            this.use.render();\n            this.ctx.restore();\n        } else {\n            this.ctx.restore();\n            this.noView();\n        }\n        return this;\n    }\n    renderLoop(PhyFun, ViewFun) {\n        let self = this;\n        let time = 0;\n        let count = 0;\n        self.__fps = 0;\n        setInterval(function () {\n            time = 1;\n        }, 1000);\n        requestAnimationFrame(function cb() {\n            count++;\n            if (time) {\n                self.__fps = count;\n                count = 0;\n                time = 0;\n            }\n            if (PhyFun) PhyFun(self);// 物理\n            let {width, height} = self.dom;\n            self.ctx.clearRect(0, 0, width, height);\n            self.render();\n            if (ViewFun) ViewFun(self);// 视角\n            requestAnimationFrame(cb);\n        });\n    }\n    get fps() {\n        return this.__fps;\n    }\n    noView() {\n        let ctx = this.ctx;\n        let {width, height} = this.dom;\n        ctx.beginPath();\n        ctx.fillStyle = this.__BGC;\n        ctx.fillRect(0, 0, width, height);\n        ctx.fillStyle = \"#fff\";\n        ctx.textAlign = \"center\";\n        ctx.font = \"50px Georgia\";\n        ctx.fillText(\"No View\", width / 2, height / 2);\n        ctx.closePath();\n        return this;\n    }\n    /**\n     * @function loadGlobal\n     * @desc 将所有全局库加载入该See3D实例\n     */\n    loadGlobal() {\n        for (let i of See3D.__loads) {\n            this.load(i);\n        }\n        return this;\n    }\n    bindLibrary(name) {// 将该库的所有API加入该See3D实例\n        let lib = this[name];\n        for (let i in lib.defines) {\n            this[i] = lib.defines[i];\n        }\n    }\n    /**\n     * @function load\n     * @param {string} name\n     * @desc 加载指定库到See3D对象中\n     */\n    load(name) {\n        this[name] = See3D.__libraries.get(name);\n        return this;\n    }\n    get dom() {\n        return this.__dom;\n    }\n    get ctx() {\n        return this.__ctx;\n    }\n    /**\n     * @function library\n     * @param {See3D.Library} entry\n     * @desc 添加See3D库\n     */\n    static library(entry) {\n        // entry\n        console.log(\"%cSee3D library %s loaded.\", \"color:#FF1493\", entry.name);\n        See3D.__libraries.set(entry.name, entry);\n    }\n    /**\n     * @function load\n     * @param {String} name\n     * @desc 添加应默认自带的库\n     */\n    static load(name) {\n        console.log(\"%cSee3D library %s added to See3D global.\", \"color:#C71585\", name);\n        See3D.__loads.push(name);\n    }\n    /**\n     * @function loadGlobal\n     * @param {String} name\n     * @desc 将该库导入到全局环境\n     */\n    static loadGlobal(name) {\n        globalThis[name] = See3D.__libraries.get(name);\n    }\n    static lib(name) {\n        See3D[name] = See3D.__libraries.get(name);\n        return See3D.__libraries.get(name);\n    }\n}\n\n!function (See3D) {\n    See3D.version = \"v0.0.1\";\n    console.log(\"See3D engine (%s) launched\", See3D.version);\n    See3D.DEBUG = true;\n    /**\n     * @property\n     * @private\n     */\n    See3D.__libraries = new Map();\n    /**\n     * @property\n     * @private\n     */\n    See3D.__loads = [];\n\n    /**\n     * @class Library\n     * @constructor\n     * @desc Library类提供了制作See3D类的接口\n     */\n    class Library {\n        constructor(name) {\n            this.name = name;\n            this.defines = {};\n        }\n        define(name, val) {\n            this.defines[name] = val;\n            return this;\n        }\n        get(name) {\n            if (this.defines[name].private) {\n                console.error(new Error(\"Error 99: It's a private value\"));\n            }\n            return this.defines[name];\n        }\n        trans() {\n            for (let i in this.defines) {\n                this[i] = this.defines[i];\n            }\n        }\n        toSee3D() {\n            for (let i in this.defines) {\n                See3D[i] = this.defines[i];\n            }\n        }\n        global() {\n            for (let i in this.defines) {\n                globalThis[i] = this.defines[i];\n            }\n        }\n    }\n    // 所有的See3D库类接口都必须继承自该类\n    class LibraryDefineObject {\n        constructor(type) {\n            this.type = type;\n        }\n        transType() {\n            return null;\n        }\n    }\n    function checkType(obj, type) {\n        return obj.type == type;\n    }\n    function translate(type, obj) {\n        return obj.transType(type);\n    }\n    See3D.Library = Library;\n    See3D.LibraryDefineObject = LibraryDefineObject;\n    See3D.checkType = checkType;\n    See3D.translate = translate;\n\n    // 设置See3D视野角度\n    See3D.FOV_x = Math.PI / 180 * 120;\n    See3D.FOV_y = Math.PI / 180 * 120;\n\n    // 设置See3D默认背景颜色\n    See3D.defaultBGC = \"#33334a\";\n}(See3D);"]}