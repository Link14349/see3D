{"version":3,"sources":["../src/index.js"],"names":["See3D","dom","document","createElement","__dom","__ctx","getContext","loadGlobal","bindLibrary","sout","IO","sostream","__scenes","use","__fps","i","w","width","height","window","innerWidth","innerHeight","s","name","n","ctx","beginPath","fillStyle","fillRect","closePath","save","translate","render","noView","restore","PhyFun","ViewFun","time","setInterval","self","requestAnimationFrame","cb","Number","toFixed","clearRect","textAlign","font","fillText","__loads","load","lib","defines","__libraries","get","entry","console","log","set","push","globalThis","version","DEBUG","Map","Library","val","private","error","Error","LibraryDefineObject","type","checkType","obj","transType","FOV_x","Math","PI","FOV_y","defaultBGC"],"mappings":"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","file":"index.js","sourcesContent":["/*!\n\n * See3D 3D Rendering Engine Library\n\n * yhzheng - v0.0.1 (Wed Feb 27 2019 22:22:36 GMT+0800)\n\n * https://github.com/qianduanXIAOHAOZI/see3D/tree/master | Released under MIT license\n\n */\n/**\n * @file index.js\n * @overview 提供整体接口\n */\n\n// const DEBUG = true;\n\n/**\n * @class See3D\n * @constructor\n * @desc See3D类是可以将一个canvas变为See3D画布的类，一切操作都依靠它 \\n\n * 也是所有See3D API的容器，相当于一个module\n */\nclass See3D {\n    constructor(dom = document.createElement(\"canvas\")) {\n        this.__dom = dom;\n        this.__ctx = dom.getContext(\"2d\");\n        this.loadGlobal();\n        this.bindLibrary(\"IO\");\n        this.bindLibrary(\"Math3D\");\n        this.sout = new See3D.IO.sostream(this);\n        this.__scenes = {};\n        this.use = null;\n        this.__fps = 0;\n        for (let i in dom) {\n            if (!this[i]) this[i] = dom[i];\n        }\n    }\n    width(w) {\n        if (w === void(0)) {\n            return this.__dom.width;\n        }\n        this.__dom.width = w;\n        return this;\n    }\n    height(w) {\n        if (w === void(0)) {\n            return this.__dom.height;\n        }\n        this.__dom.height = w;\n        return this;\n    }\n    full() {\n        this\n            .width(window.innerWidth)\n            .height(window.innerHeight)\n        ;\n        return this;\n    }\n    push(s) {\n        this.__scenes[s.name] = s;\n        if (!this.use) this.use = s;\n        return this;\n    }\n    scene(n) {\n        this.use = this.__scenes[n];\n        return this;\n    }\n    render() {\n        this.ctx.beginPath();\n        this.ctx.fillStyle = \"#33334a\";\n        this.ctx.fillRect(0, 0, this.dom.width, this.dom.height);\n        this.ctx.closePath();\n        this.ctx.save();\n        this.ctx.translate(this.dom.width / 2, this.dom.height / 2);\n        if (this.use) {\n            this.use.render();\n        } else {\n            this.noView();\n        }\n        this.ctx.restore();\n        return this;\n    }\n    renderLoop(PhyFun, ViewFun) {\n        let time = 0;\n        setInterval(function () {\n            time++;\n        }, 1);\n        let self = this;\n        requestAnimationFrame(function cb() {\n            self.__fps = Number((1000 / time).toFixed(2));\n            time = 0;\n            if (PhyFun) PhyFun(self);// 物理\n            let {width, height} = self.dom;\n            self.ctx.clearRect(0, 0, width, height);\n            self.render();\n            if (ViewFun) ViewFun(self);// 视角\n            requestAnimationFrame(cb);\n        });\n    }\n    get fps() {\n        return this.__fps;\n    }\n    noView() {\n        let ctx = this.ctx;\n        let {width, height} = this.dom;\n        ctx.beginPath();\n        ctx.fillStyle = \"#33334a\";\n        ctx.fillRect(0, 0, width, height);\n        ctx.fillStyle = \"#fff\";\n        ctx.textAlign = \"center\";\n        ctx.font = \"50px Georgia\";\n        ctx.fillText(\"No View\", width / 2, height / 2);\n        ctx.closePath();\n        return this;\n    }\n    /**\n     * @function loadGlobal\n     * @desc 将所有全局库加载入该See3D实例\n     */\n    loadGlobal() {\n        for (let i of See3D.__loads) {\n            this.load(i);\n        }\n        return this;\n    }\n    bindLibrary(name) {// 将该库的所有API加入该See3D实例\n        let lib = this[name];\n        for (let i in lib.defines) {\n            this[i] = lib.defines[i];\n        }\n    }\n    /**\n     * @function load\n     * @param {string} name\n     * @desc 加载指定库到See3D对象中\n     */\n    load(name) {\n        this[name] = See3D.__libraries.get(name);\n        return this;\n    }\n    get dom() {\n        return this.__dom;\n    }\n    get ctx() {\n        return this.__ctx;\n    }\n    /**\n     * @function library\n     * @param {See3D.Library} entry\n     * @desc 添加See3D库\n     */\n    static library(entry) {\n        // entry\n        console.log(\"%cSee3D library %s loaded.\", \"color:#FF1493\", entry.name);\n        See3D.__libraries.set(entry.name, entry);\n    }\n    /**\n     * @function load\n     * @param {String} name\n     * @desc 添加应默认自带的库\n     */\n    static load(name) {\n        console.log(\"%cSee3D library %s added to See3D global.\", \"color:#C71585\", name);\n        See3D.__loads.push(name);\n    }\n    /**\n     * @function loadGlobal\n     * @param {String} name\n     * @desc 将该库导入到全局环境\n     */\n    static loadGlobal(name) {\n        globalThis[name] = See3D.__libraries.get(name);\n    }\n    static lib(name) {\n        See3D[name] = See3D.__libraries.get(name);\n        return See3D.__libraries.get(name);\n    }\n}\n\n!function (See3D) {\n    See3D.version = \"v0.0.1\";\n    console.log(\"See3D engine (%s) launched\", See3D.version);\n    See3D.DEBUG = true;\n    /**\n     * @property\n     * @private\n     */\n    See3D.__libraries = new Map();\n    /**\n     * @property\n     * @private\n     */\n    See3D.__loads = [];\n\n    /**\n     * @class Library\n     * @constructor\n     * @desc Library类提供了制作See3D类的接口\n     */\n    class Library {\n        constructor(name) {\n            this.name = name;\n            this.defines = {};\n        }\n        define(name, val) {\n            this.defines[name] = val;\n            return this;\n        }\n        get(name) {\n            if (this.defines[name].private) {\n                console.error(new Error(\"Error 99: It's a private value\"));\n            }\n            return this.defines[name];\n        }\n        trans() {\n            for (let i in this.defines) {\n                this[i] = this.defines[i];\n            }\n        }\n        toSee3D() {\n            for (let i in this.defines) {\n                See3D[i] = this.defines[i];\n            }\n        }\n        global() {\n            for (let i in this.defines) {\n                globalThis[i] = this.defines[i];\n            }\n        }\n    }\n    // 所有的See3D库类接口都必须继承自该类\n    class LibraryDefineObject {\n        constructor(type) {\n            this.type = type;\n        }\n        transType() {\n            return null;\n        }\n    }\n    function checkType(obj, type) {\n        return obj.type == type;\n    }\n    function translate(type, obj) {\n        return obj.transType(type);\n    }\n    See3D.Library = Library;\n    See3D.LibraryDefineObject = LibraryDefineObject;\n    See3D.checkType = checkType;\n    See3D.translate = translate;\n\n    // 设置See3D视野角度\n    See3D.FOV_x = Math.PI / 180 * 120;\n    See3D.FOV_y = Math.PI / 180 * 120;\n    See3D.defaultBGC = \"\";\n}(See3D);"]}